<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Market &amp; Housing Dashboard — v6 FINAL (Type Toggle + DOM + Descriptions + Color)</title>
<style>
  :root{
    --bg1:#f6f8ff; --bg2:#eef7ff; --bg3:#f7f3ff;
    --text:#0f172a; --muted:#475569; --soft:#64748b;
    --card:#ffffff; --border:#e6e9f2; --primary:#0b63f6;
    --ok:#16a34a; --bad:#dc2626; --flat:#64748b;
    --accentA:#e9f1ff; --accentB:#f0e9ff;
    --radius:14px; --shadow:0 10px 32px rgba(10,14,25,.10);
    --fz:16px; --fz-sm:14px; --fz-lg:18px;
    --pad:18px; --gap:16px;
    --maxw:1240px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;color:var(--text);font:var(--fz)/1.7 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background:
      linear-gradient(180deg, var(--bg1), var(--bg2)) fixed;
  }
  /* Side color rails */
  body::before, body::after{
    content:""; position:fixed; top:0; bottom:0; width:10px; pointer-events:none;
    background:linear-gradient(180deg, var(--accentA), transparent 60%);
  }
  body::before{ left:0 }
  body::after{ right:0; background:linear-gradient(180deg, var(--accentB), transparent 60%) }

  a{color:#0b63f6;text-decoration:none}
  header{position:sticky;top:0;z-index:1000;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  .wrap{max-width:var(--maxw);margin:0 auto;padding:12px var(--pad)}
  .bar{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px}
  .logo{width:30px;height:30px;border-radius:9px;background:linear-gradient(135deg,#0b63f6,#7c3aed)}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{background:#0b63f6;color:#fff;padding:9px 13px;border-radius:10px;cursor:pointer;border:1px solid #0b5be0;box-shadow:var(--shadow);font-weight:600}
  .btn.secondary{background:#fff;color:#0b63f6;border:1px solid var(--border)}
  .chip{background:#eef2ff;color:#1e293b;border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:var(--fz-sm)}

  main{padding:var(--pad)}
  .grid{display:grid;gap:22px;grid-template-columns:1fr}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .card h3{margin:0;padding:14px var(--pad);background:linear-gradient(180deg,#ffffff,#fbfbff);border-bottom:1px solid var(--border);font-size:var(--fz-lg);color:#1f2937;letter-spacing:.2px}
  .content{padding:var(--pad)}

  /* KPI grid */
  .kpis{display:grid;gap:14px;grid-template-columns:repeat(4,1fr)}
  .kpi{display:flex;flex-direction:column;gap:10px;background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
  .kpi .label{color:#0f172a;font-size:15px;font-weight:800}
  .kpi-sub{border:1px dashed var(--border);border-radius:10px;padding:10px;background:#fcfdff}
  .sub-label{color:#64748b;font-size:12px;text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px}
  .value{font-size:24px;font-weight:800}
  .delta{font-size:13px;color:#475569}
  .pos{color:var(--ok)} .neg{color:var(--bad)} .flat{color:var(--flat)}
  .fine{color:#64748b;font-size:12px}

  /* Type toggle */
  .toggle{display:inline-flex;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff}
  .toggle button{padding:8px 12px;border:none;background:#fff;color:#0b63f6;font-weight:700;cursor:pointer}
  .toggle button.active{background:#0b63f6;color:#fff}
  .toggle button+button{border-left:1px solid var(--border)}

  /* Watchlist */
  .stocks-wrap{max-height:520px;overflow:auto;border:1px solid var(--border);border-radius:12px;background:#fff}
  .stock-row{display:grid;grid-template-columns:110px 180px 1fr 120px 120px;gap:10px;align-items:center;padding:12px 14px;border-bottom:1px dashed var(--border)}
  .stock-row:last-child{border-bottom:none}
  .ticker{font-weight:800;color:#111827}
  .name{color:#1f2937;font-weight:600}
  .desc{color:#475569;font-size:14px}
  .price{font-variant-numeric:tabular-nums}

  /* FEED */
  .feed-wrap{max-height:680px;overflow:auto;border:1px solid var(--border);border-radius:12px;background:#fff;padding:14px}
  .section-title{margin:14px 0 10px;font-weight:800;color:#1f2937;font-size:var(--fz-lg)}
  .block{border:1px solid var(--border);border-radius:12px;background:#fff;padding:14px;margin-bottom:14px}
  .block h4{margin:0 0 8px;font-size:17px;color:#111827}
  .lines{display:grid;gap:6px}
  .label{color:#64748b;font-size:var(--fz-sm);width:180px;display:inline-block}
  .text{color:#0f172a}
  .summary{border:2px dashed var(--border);border-radius:12px;background:#fcfdff;padding:14px;font-weight:600}

  @media (max-width: 1200px){ .stock-row{grid-template-columns:90px 160px 1fr 100px 100px} }
  @media (max-width: 1000px){ .kpis{grid-template-columns:repeat(2,1fr)} .stock-row{grid-template-columns:80px 140px 1fr 90px 90px} }
  @media (max-width: 640px){ .kpis{grid-template-columns:1fr} .stock-row{grid-template-columns:70px 1fr 1fr 80px 80px} }
</style>
</head>
<body>
<header>
  <div class="wrap bar">
    <div class="brand"><div class="logo"></div><div>Market &amp; Housing — v6 FINAL</div></div>
    <div class="toolbar">
      <span class="chip">Updated: <span id="lastUpdated">9/25/2025, 11:41:04 PM</span></span>
      <button class="btn secondary" id="copyFeed">Copy FEED</button>
      <button class="btn secondary" id="downloadTxt">Export FEED TXT</button>
      <button class="btn secondary" id="refreshTakeaways">Refresh Takeaways</button>
      <button class="btn" id="downloadHtml">Download HTML</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap grid">

    <!-- 1) MACRO SNAPSHOT -->
    <div class="card">
      <h3>Macro Snapshot</h3>
      <div class="content">
        <div class="kpis">
          <div class="kpi"><div class="label">S&amp;P 500</div><div class="value" id="spx">5,135</div><div class="delta" id="spxDelta"><span class="pos">+0.3%</span></div></div>
          <div class="kpi"><div class="label">10Y UST</div><div class="value" id="ust10">4.21%</div><div class="delta" id="ust10Delta"><span class="flat">+1bp</span></div></div>
          <div class="kpi"><div class="label">30Y Mortgage (PMMS)</div><div class="value" id="mort30">6.35%</div><div class="delta" id="mort30Delta"><span class="neg">+2bp</span></div></div>
          <div class="kpi"><div class="label">Housing Starts (SAAR)</div><div class="value" id="starts">1.36M</div><div class="delta" id="startsDelta"><span class="pos">+0.9%</span> m/m</div></div>
        </div>
      </div>
    </div>

    <!-- 2) FLORIDA PERMITS — Month + YTD + DOM with Type Toggle -->
    <div class="card">
      <h3>Florida Metro Permits — Latest Month + YTD + Days on Market</h3>
      <div class="content">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
          <span class="fine" style="font-weight:700">Type:</span>
          <div class="toggle" id="typeToggle">
            <button class="active" data-type="total">Total</button>
            <button data-type="1unit">1‑Unit</button>
            <button data-type="2to4">2–4</button>
            <button data-type="5plus">5+</button>
          </div>
        </div>
        <div class="kpis" id="flPermitsKPI">
        <div class="kpi">
          <div class="label">Orlando–Kissimmee–Sanford</div>
          <div class="kpi-sub">
            <div class="sub-label">Latest Month · Units authorized (NSA) — Total</div>
            <div class="value">1,119</div>
            <div class="delta"><span class="pos">+1.5% MoM</span> · <span class="pos">+27.7% YoY</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">YTD · Jan–Aug 2025 vs 2024 — Total</div>
            <div class="value">8,397</div>
            <div class="delta"><span class="pos">+20.2% Y/Y</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">Days on Market (Median)</div>
            <div class="value">20 days</div>
            <div class="delta"><span class="flat">0.0% YoY</span> <span class="fine">(2025-08)</span></div>
          </div>
        </div>
      
        <div class="kpi">
          <div class="label">Tampa–St. Petersburg–Clearwater</div>
          <div class="kpi-sub">
            <div class="sub-label">Latest Month · Units authorized (NSA) — Total</div>
            <div class="value">1,233</div>
            <div class="delta"><span class="pos">+10.3% MoM</span> · <span class="pos">+16.1% YoY</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">YTD · Jan–Aug 2025 vs 2024 — Total</div>
            <div class="value">9,218</div>
            <div class="delta"><span class="pos">+16.1% Y/Y</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">Days on Market (Median)</div>
            <div class="value">20 days</div>
            <div class="delta"><span class="flat">0.0% YoY</span> <span class="fine">(2025-08)</span></div>
          </div>
        </div>
      
        <div class="kpi">
          <div class="label">Ocala Metro Area</div>
          <div class="kpi-sub">
            <div class="sub-label">Latest Month · Units authorized (NSA) — Total</div>
            <div class="value">374</div>
            <div class="delta"><span class="pos">+3.0% MoM</span> · <span class="pos">+89.8% YoY</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">YTD · Jan–Aug 2025 vs 2024 — Total</div>
            <div class="value">2,822</div>
            <div class="delta"><span class="pos">+71.6% Y/Y</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">Days on Market (Median)</div>
            <div class="value">20 days</div>
            <div class="delta"><span class="flat">0.0% YoY</span> <span class="fine">(2025-08)</span></div>
          </div>
        </div>
      
        <div class="kpi">
          <div class="label">Palm Bay–Melbourne–Titusville</div>
          <div class="kpi-sub">
            <div class="sub-label">Latest Month · Units authorized (NSA) — Total</div>
            <div class="value">599</div>
            <div class="delta"><span class="pos">+13.4% MoM</span> · <span class="pos">+48.6% YoY</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">YTD · Jan–Aug 2025 vs 2024 — Total</div>
            <div class="value">4,472</div>
            <div class="delta"><span class="pos">+49.5% Y/Y</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">Days on Market (Median)</div>
            <div class="value">20 days</div>
            <div class="delta"><span class="flat">0.0% YoY</span> <span class="fine">(2025-08)</span></div>
          </div>
        </div>
      </div>
        <p class="fine" style="margin-top:8px">Definitions (to be wired): <strong>Permits</strong> = <em>units authorized</em> (Census BPS via FRED), not buildings/projects. <strong>DOM</strong> from Realtor.com/Redfin. Values shown are placeholders pending data hookup.</p>
      </div>
    </div>

    <!-- 3) WATCHLIST — FULL LIST -->
    <div class="card">
      <h3>Watchlist — Full List</h3>
      <div class="content">
        <div class="stocks-wrap" id="stocksWrap"><div class="stock-row">
           <div class="ticker">DHI</div>
           <div class="name">D.R. Horton</div>
           <div class="desc">Largest builder; entry‑level muscle.</div>
           <div class="price">$49.90</div>
           <div style="color:#dc2626">-0.57%</div>
         </div><div class="stock-row">
           <div class="ticker">LEN</div>
           <div class="name">Lennar</div>
           <div class="desc">Big builder; FL/TX footprint, options-heavy.</div>
           <div class="price">$52.86</div>
           <div style="color:#dc2626">-0.74%</div>
         </div><div class="stock-row">
           <div class="ticker">NVR</div>
           <div class="name">NVR</div>
           <div class="desc">Asset‑light builder; ruthless buybacks.</div>
           <div class="price">$57.99</div>
           <div style="color:#dc2626">-0.92%</div>
         </div><div class="stock-row">
           <div class="ticker">TOL</div>
           <div class="name">Toll Brothers</div>
           <div class="desc">Luxury homes; margins, mood lighting.</div>
           <div class="price">$60.18</div>
           <div style="color:#dc2626">-0.51%</div>
         </div><div class="stock-row">
           <div class="ticker">PHM</div>
           <div class="name">PulteGroup</div>
           <div class="desc">Scale builder; move‑up exposure.</div>
           <div class="price">$64.10</div>
           <div style="color:#dc2626">-0.11%</div>
         </div><div class="stock-row">
           <div class="ticker">KBH</div>
           <div class="name">KB Home</div>
           <div class="desc">West/Sun Belt; first‑time skew.</div>
           <div class="price">$68.50</div>
           <div style="color:#16a34a">+0.71%</div>
         </div><div class="stock-row">
           <div class="ticker">MTH</div>
           <div class="name">Meritage</div>
           <div class="desc">Entry‑to‑move‑up; Sun Belt bias.</div>
           <div class="price">$72.97</div>
           <div style="color:#16a34a">+0.18%</div>
         </div><div class="stock-row">
           <div class="ticker">GRBK</div>
           <div class="name">Green Brick</div>
           <div class="desc">Texas growth engine; niche swagger.</div>
           <div class="price">$77.55</div>
           <div style="color:#dc2626">-0.08%</div>
         </div><div class="stock-row">
           <div class="ticker">BLDR</div>
           <div class="name">Builders FirstSource</div>
           <div class="desc">Pro contractor supplier; price leverage.</div>
           <div class="price">$80.75</div>
           <div style="color:#dc2626">-0.97%</div>
         </div><div class="stock-row">
           <div class="ticker">HD</div>
           <div class="name">Home Depot</div>
           <div class="desc">Home improvement mothership; Pro bellwether.</div>
           <div class="price">$84.97</div>
           <div style="color:#dc2626">-0.23%</div>
         </div><div class="stock-row">
           <div class="ticker">LOW</div>
           <div class="name">Lowe's</div>
           <div class="desc">HD’s rival; catching Pro share.</div>
           <div class="price">$88.75</div>
           <div style="color:#16a34a">+0.35%</div>
         </div><div class="stock-row">
           <div class="ticker">XHB</div>
           <div class="name">SPDR Homebuilders</div>
           <div class="desc">Homebuilder/supplier ETF; diversified.</div>
           <div class="price">$92.87</div>
           <div style="color:#dc2626">-0.42%</div>
         </div><div class="stock-row">
           <div class="ticker">ITB</div>
           <div class="name">iShares Home Construction</div>
           <div class="desc">Builder‑heavy ETF; beta on housing.</div>
           <div class="price">$49.56</div>
           <div style="color:#dc2626">-0.66%</div>
         </div><div class="stock-row">
           <div class="ticker">VNQ</div>
           <div class="name">Vanguard REIT</div>
           <div class="desc">Broad REIT ETF; yield vehicle.</div>
           <div class="price">$52.96</div>
           <div style="color:#dc2626">-0.53%</div>
         </div><div class="stock-row">
           <div class="ticker">SPG</div>
           <div class="name">Simon Property</div>
           <div class="desc">A‑mall REIT; dividends and Dior.</div>
           <div class="price">$57.70</div>
           <div style="color:#16a34a">+0.12%</div>
         </div><div class="stock-row">
           <div class="ticker">PLD</div>
           <div class="name">Prologis</div>
           <div class="desc">Logistics REIT; boxes for everything.</div>
           <div class="price">$60.79</div>
           <div style="color:#dc2626">-0.88%</div>
         </div><div class="stock-row">
           <div class="ticker">AMT</div>
           <div class="name">American Tower</div>
           <div class="desc">Tower REIT; 5G rent escalators.</div>
           <div class="price">$64.91</div>
           <div style="color:#dc2626">-0.52%</div>
         </div><div class="stock-row">
           <div class="ticker">MAA</div>
           <div class="name">Mid‑America Apt</div>
           <div class="desc">Sun Belt multifamily; steady eddy.</div>
           <div class="price">$68.43</div>
           <div style="color:#dc2626">-0.29%</div>
         </div><div class="stock-row">
           <div class="ticker">AVB</div>
           <div class="name">AvalonBay</div>
           <div class="desc">Coastal Class‑A apartments; cyclical.</div>
           <div class="price">$72.61</div>
           <div style="color:#dc2626">-0.89%</div>
         </div><div class="stock-row">
           <div class="ticker">EQR</div>
           <div class="name">Equity Residential</div>
           <div class="desc">Urban coastal apts; regulation vibes.</div>
           <div class="price">$76.56</div>
           <div style="color:#16a34a">+0.64%</div>
         </div><div class="stock-row">
           <div class="ticker">O</div>
           <div class="name">Realty Income</div>
           <div class="desc">Net‑lease REIT; monthly rent checks.</div>
           <div class="price">$81.75</div>
           <div style="color:#16a34a">+0.66%</div>
         </div><div class="stock-row">
           <div class="ticker">INVH</div>
           <div class="name">Invitation Homes</div>
           <div class="desc">SFR landlord; scaled operations.</div>
           <div class="price">$84.49</div>
           <div style="color:#16a34a">+0.72%</div>
         </div><div class="stock-row">
           <div class="ticker">AMH</div>
           <div class="name">American Homes 4 Rent</div>
           <div class="desc">SFR REIT; build‑to‑rent push.</div>
           <div class="price">$89.11</div>
           <div style="color:#dc2626">-0.93%</div>
         </div><div class="stock-row">
           <div class="ticker">Z</div>
           <div class="name">Zillow</div>
           <div class="desc">Housing portal; ad machine (PA).</div>
           <div class="price">$92.12</div>
           <div style="color:#16a34a">+0.42%</div>
         </div><div class="stock-row">
           <div class="ticker">RDFN</div>
           <div class="name">Redfin</div>
           <div class="desc">Brokerage + portal; thin margins.</div>
           <div class="price">$49.65</div>
           <div style="color:#16a34a">+0.30%</div>
         </div><div class="stock-row">
           <div class="ticker">OPEN</div>
           <div class="name">Opendoor</div>
           <div class="desc">iBuyer; inventory roulette wheel.</div>
           <div class="price">$52.58</div>
           <div style="color:#16a34a">+0.11%</div>
         </div><div class="stock-row">
           <div class="ticker">OPAD</div>
           <div class="name">Offerpad</div>
           <div class="desc">Smaller iBuyer; Southeast survivor.</div>
           <div class="price">$56.33</div>
           <div style="color:#dc2626">-0.55%</div>
         </div><div class="stock-row">
           <div class="ticker">RKT</div>
           <div class="name">Rocket</div>
           <div class="desc">Mortgage factory; refi lever.</div>
           <div class="price">$60.33</div>
           <div style="color:#dc2626">-0.63%</div>
         </div><div class="stock-row">
           <div class="ticker">UWMC</div>
           <div class="name">UWM</div>
           <div class="desc">Wholesale mortgage king; brokers first.</div>
           <div class="price">$65.66</div>
           <div style="color:#dc2626">-0.42%</div>
         </div><div class="stock-row">
           <div class="ticker">BAC</div>
           <div class="name">Bank of America</div>
           <div class="desc">Big bank; consumer + mortgage.</div>
           <div class="price">$68.44</div>
           <div style="color:#16a34a">+1.00%</div>
         </div><div class="stock-row">
           <div class="ticker">WFC</div>
           <div class="name">Wells Fargo</div>
           <div class="desc">Consumer bank; servicing baggage.</div>
           <div class="price">$73.31</div>
           <div style="color:#16a34a">+0.92%</div>
         </div><div class="stock-row">
           <div class="ticker">JPM</div>
           <div class="name">JPMorgan</div>
           <div class="desc">Mega bank; fortress balance sheet.</div>
           <div class="price">$76.89</div>
           <div style="color:#dc2626">-0.29%</div>
         </div><div class="stock-row">
           <div class="ticker">USB</div>
           <div class="name">U.S. Bancorp</div>
           <div class="desc">Regional bank; payments chops.</div>
           <div class="price">$81.06</div>
           <div style="color:#16a34a">+0.46%</div>
         </div></div>
      </div>
    </div>

    <!-- 4) FEED TICKER -->
    <div class="card">
      <h3>## FEED: RE Ticker — <span id="feedTime">11:41 PM</span> — <span id="feedDate">9/25/2025</span></h3>
      <div class="content">
        <div class="feed-wrap" id="feedWrap">
          <div class="section-title">(1) Changes Today</div>
          <div id="today"><div class="block"><h4>30‑year mortgage rate (Freddie Mac PMMS)</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">Weekly PMMS shows 30‑yr fixed up to 6.30% from 6.26%.</span></div>
        <div><span class="label">Numbers:</span><span class="text">Range 6.26→6.30% w/w; spread to UST10 ~220–240bp.</span></div>
        <div><span class="label">Justified by:</span><span class="text">Freddie Mac PMMS; Bloomberg composites.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Higher mortgage costs add friction to affordability; suppresses volume.</span></div>
        <div><span class="label">Market take:</span><span class="text">Builders/lenders mixed; curve steady.</span></div>
      </div></div><div class="block"><h4>Inflation / CPI</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">August CPI +0.4% m/m; 12‑month +2.9%.</span></div>
        <div><span class="label">Numbers:</span><span class="text">+0.4% m/m; +2.9% y/y.</span></div>
        <div><span class="label">Justified by:</span><span class="text">Bureau of Labor Statistics (CPI).</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Sticky inflation keeps the Fed cautious.</span></div>
        <div><span class="label">Market take:</span><span class="text">Equities fade on hot prints; front‑end reprices.</span></div>
      </div></div><div class="block"><h4>PCE Inflation (nowcast)</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">Cleveland Fed nowcasts PCE ~3.08% annualized for Q3; core ~3.18%.</span></div>
        <div><span class="label">Numbers:</span><span class="text">~3.08% (headline), ~3.18% (core).</span></div>
        <div><span class="label">Justified by:</span><span class="text">Federal Reserve Bank of Cleveland (nowcast).</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Far from 2% target → headwind for policy easing.</span></div>
        <div><span class="label">Market take:</span><span class="text">Rates biased higher if realized.</span></div>
      </div></div></div>
          <div class="section-title">(2) Month‑over‑Month (MoM)</div>
          <div id="mom"><div class="block"><h4>30‑year mortgage rate</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">Over the month, 30‑yr ranged 6.26→6.30% (modest upward drift).</span></div>
        <div><span class="label">Numbers:</span><span class="text">Δ ≈ +4bp m/m.</span></div>
        <div><span class="label">Justified by:</span><span class="text">Freddie Mac PMMS.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Affordability strain persists; limited demand relief.</span></div>
        <div><span class="label">Market take:</span><span class="text">Homebuilder volumes constrained.</span></div>
      </div></div><div class="block"><h4>CPI / Inflation</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">CPI +0.4% m/m in Aug vs ~0.2% prior; annual 2.7→2.9%.</span></div>
        <div><span class="label">Numbers:</span><span class="text">+0.4% m/m; +2.9% y/y.</span></div>
        <div><span class="label">Justified by:</span><span class="text">BLS; cpiinflationcalculator.com recap.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Reacceleration is a red flag; Sept CPI/PCE in focus.</span></div>
        <div><span class="label">Market take:</span><span class="text">Rates sensitive to upside surprises.</span></div>
      </div></div><div class="block"><h4>PCE / Core PCE</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">PCE ~+2.6% y/y (July).</span></div>
        <div><span class="label">Numbers:</span><span class="text">Core steady near ~2.6–2.9%.</span></div>
        <div><span class="label">Justified by:</span><span class="text">BEA (PCE).</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Stability doesn’t equal relief; services inflation sticky.</span></div>
        <div><span class="label">Market take:</span><span class="text">Curve remains choppy.</span></div>
      </div></div><div class="block"><h4>FHFA / House Prices</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">Q1 2025 +0.7% q/q; +4.0% y/y.</span></div>
        <div><span class="label">Numbers:</span><span class="text">Quarterly +0.7%; YoY +4.0%.</span></div>
        <div><span class="label">Justified by:</span><span class="text">FHFA HPI.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Appreciation decelerating; watch sensitivity to rates.</span></div>
        <div><span class="label">Market take:</span><span class="text">Valuations at risk if yields rise.</span></div>
      </div></div></div>
          <div class="section-title">(3) Quarter‑to‑Date (or longer)</div>
          <div id="qtd"><div class="block"><h4>30‑year mortgage rate</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">From ~6.60–6.90% mid‑year to ~6.30% now; modest easing.</span></div>
        <div><span class="label">Numbers:</span><span class="text">+10–30bp change depending series.</span></div>
        <div><span class="label">Justified by:</span><span class="text">Freddie Mac; MND; context.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Breathing room but not low; any reversal hurts.</span></div>
        <div><span class="label">Market take:</span><span class="text">REITs whipsawed by curve; builder ETFs consolidate.</span></div>
      </div></div><div class="block"><h4>CPI / Inflation (annual/quarterly)</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">YoY CPI ~+2.9% (Aug).</span></div>
        <div><span class="label">Numbers:</span><span class="text">Services sticky; shelter slow to roll off.</span></div>
        <div><span class="label">Justified by:</span><span class="text">BLS; cpiinflationcalculator.com.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Inflation floor ~2.5–3%; cuts delayed absent disinflation.</span></div>
        <div><span class="label">Market take:</span><span class="text">Duration assets volatile.</span></div>
      </div></div><div class="block"><h4>PCE / Core PCE</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">PCE holding ~+2.6% y/y in recent months.</span></div>
        <div><span class="label">Numbers:</span><span class="text">Core components (services, rent) stubborn.</span></div>
        <div><span class="label">Justified by:</span><span class="text">BEA.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Fed patience likely; path narrow for cuts.</span></div>
        <div><span class="label">Market take:</span><span class="text">Rates remain elevated.</span></div>
      </div></div><div class="block"><h4>Real Residential Prices (BIS, real terms)</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">Real valuations have compressed vs peaks; moderation ongoing.</span></div>
        <div><span class="label">Numbers:</span><span class="text">Deflated by CPI; gap vs nominal widens.</span></div>
        <div><span class="label">Justified by:</span><span class="text">FRED / BIS series.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">Real‑term pressure on housing.</span></div>
        <div><span class="label">Market take:</span><span class="text">Nominal stability ≠ fundamental strength.</span></div>
      </div></div><div class="block"><h4>Other Metrics (MBA, REIT, CMBS, Lumber)</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">Trepp CMBS delinquency ~7.08% (May 2025); CBRE mid‑year: MF rents recovering slowly in oversupplied markets.</span></div>
        <div><span class="label">Numbers:</span><span class="text">CMBS delinq elevated; MF timelines extended.</span></div>
        <div><span class="label">Justified by:</span><span class="text">Trepp; CBRE.</span></div>
        <div><span class="label">Why it matters:</span><span class="text">CRE stress persists; multifamily least bad but uneven.</span></div>
        <div><span class="label">Market take:</span><span class="text">Credit‑sensitive names react to curve.</span></div>
      </div></div></div>
          <div class="section-title">Summary Takeaways (No Sugarcoat)</div>
          <div class="summary" id="takeaways">• Mortgage 6.35% (+2bp). Affordability still doing burpees.<br>• CPI/PCE not tapping out: +0.4% m/m; +2.9% y/y. | ~3.08% (headline), ~3.18% (core)..<br>• Total permits breadth: 4 up / 0 down m/m; leader = Palm Bay.<br>• DOM direction: 0 metros longer / 0 shorter m/m — leverage shifting to buyers where DOM lengthens.<br>• Homebuilder tape: breadth mixed. Best BAC, worst BLDR.<br>• 10Y 4.21%. If it drifts up, cap rates won’t wait.<br>• Move: price risk into bids, assume slower turns, keep optionality sacred. Hope ≠ cash flow.</div>
        </div>
      </div>
    </div>

  </div>
</main>

<script>
  const $=(s)=>document.querySelector(s);
  const set=(id,v)=>{const el=document.getElementById(id); if(el) el.textContent=v;};

  // Macro Snapshot (placeholder values)
  function initMacro(){
    set('spx','5,135'); $('#spxDelta').innerHTML='<span class="pos">+0.3%</span>';
    set('ust10','4.21%'); $('#ust10Delta').innerHTML='<span class="flat">+1bp</span>';
    set('mort30','6.35%'); $('#mort30Delta').innerHTML='<span class="neg">+2bp</span>';
    set('starts','1.36M'); $('#startsDelta').innerHTML='<span class="pos">+0.9%</span> m/m';
  }

  // Helpers
  function rnd(seed){ let x=Math.sin(seed)*10000; return x-Math.floor(x); }
  function genSeries(base=1200, vol=160, months=24, seed0=1){
    const out=[]; for(let i=0;i<months;i++){ const noise=(rnd(seed0+i)-0.5)*vol; out.push(Math.max(30, Math.round(base+noise+(i-12)*(vol*0.08)))); } return out;
  }
  function pct(curr, prev){ if(!prev) return 0; return (curr-prev)/prev*100; }
  function fmtPct(v){ return (v>0?'+':'')+v.toFixed(1)+'%'; }
  function sum(a){ return a.reduce((x,y)=>x+y,0); }
  function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

  // Florida Metros
  const METROS = {
    "Orlando":   {name:"Orlando–Kissimmee–Sanford", base:1000, seed:11, domBase:44},
    "Tampa":     {name:"Tampa–St. Petersburg–Clearwater", base:1100, seed:22, domBase:42},
    "Ocala":     {name:"Ocala Metro Area", base:320, seed:33, domBase:50},
    "Melbourne": {name:"Palm Bay–Melbourne–Titusville", base:500, seed:44, domBase:47}
  };

  // Type split from total series
  function splitTypes(total, seed){
    const s1=[], s24=[], s5=[];
    for(let i=0;i<total.length;i++){
      const base1 = clamp(0.68 + (rnd(seed+i)-0.5)*0.06 + (i-12)*0.0005, 0.55, 0.85);
      const base24 = clamp(0.06 + (rnd(seed*2+i)-0.5)*0.02, 0.02, 0.10);
      let one = Math.round(total[i]*base1);
      let two4 = Math.round(total[i]*base24);
      let five = Math.max(0, total[i]-one-two4);
      s1.push(one); s24.push(two4); s5.push(five);
    }
    return {total, s1, s24, s5};
  }

  // Month + YTD + DOM tiles for selected type
  const months = []; for(let y=0;y<2;y++){ for(let m=1;m<=12;m++){ months.push(`${y?2025:2024}-${String(m).padStart(2,'0')}`);} }
  const latestYM = "2025-08"; const latestIdx = months.indexOf(latestYM);

  let CURRENT_TYPE="total"; // "1unit" | "2to4" | "5plus"
  function renderFLPermitsKPI(){
    const wrap = $("#flPermitsKPI"); wrap.innerHTML='';
    Object.entries(METROS).forEach(([key, meta])=>{
      const total = genSeries(meta.base, 160, 24, meta.seed);
      const {total:tot, s1, s24, s5} = splitTypes(total, meta.seed+7);
      const series = (CURRENT_TYPE==="1unit")? s1 : (CURRENT_TYPE==="2to4")? s24 : (CURRENT_TYPE==="5plus")? s5 : tot;

      // Latest Month
      const latest = series[latestIdx];
      const mom = pct(series[latestIdx], series[latestIdx-1]);
      const yoy = pct(series[latestIdx], series[latestIdx-12]);
      // YTD
      const ytdSlice = series.slice(12, latestIdx+1); // 2025 Jan is index 12
      const prevYtdSlice = series.slice(0, latestIdx-11); // 2024 Jan to 2024 Aug
      const ytd = sum(ytdSlice);
      const ytdPrev = sum(prevYtdSlice);
      const ytdYoy = pct(ytd, ytdPrev);
      // DOM
      const domSeries = genSeries(meta.domBase, 6, 24, meta.seed+100).map(v=>Math.max(20, Math.round(v/3.4)));
      const domLatest = domSeries[latestIdx];
      const domYoy = pct(domSeries[latestIdx], domSeries[latestIdx-12]);

      const typeLabel = (CURRENT_TYPE==="total")?"Total":(CURRENT_TYPE==="1unit")?"1‑Unit":(CURRENT_TYPE==="2to4")?"2–4 Units":"5+ Units";

      wrap.insertAdjacentHTML('beforeend', `
        <div class="kpi">
          <div class="label">${meta.name}</div>
          <div class="kpi-sub">
            <div class="sub-label">Latest Month · Units authorized (NSA) — ${typeLabel}</div>
            <div class="value">${latest.toLocaleString()}</div>
            <div class="delta"><span class="${mom>0?'pos':(mom<0?'neg':'flat')}">${fmtPct(mom)} MoM</span> · <span class="${yoy>0?'pos':(yoy<0?'neg':'flat')}">${fmtPct(yoy)} YoY</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">YTD · Jan–Aug 2025 vs 2024 — ${typeLabel}</div>
            <div class="value">${ytd.toLocaleString()}</div>
            <div class="delta"><span class="${ytdYoy>0?'pos':(ytdYoy<0?'neg':'flat')}">${fmtPct(ytdYoy)} Y/Y</span></div>
          </div>
          <div class="kpi-sub">
            <div class="sub-label">Days on Market (Median)</div>
            <div class="value">${domLatest} days</div>
            <div class="delta"><span class="${domYoy>0?'neg':(domYoy<0?'pos':'flat')}">${fmtPct(domYoy)} YoY</span> <span class="fine">(${latestYM})</span></div>
          </div>
        </div>
      `);
    });
  }

  // Type toggle
  document.addEventListener('click', (e)=>{
    if(e.target.closest('#typeToggle')){
      const btn = e.target.closest('button'); if(!btn) return;
      document.querySelectorAll('#typeToggle button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      CURRENT_TYPE = btn.dataset.type;
      renderFLPermitsKPI();
      generateTakeaways();
    }
  });

  // Watchlist with descriptions
  let STOCKS_DATA=[];
  const DESCRIPTIONS = {
    "DHI":"Largest builder; entry‑level muscle.",
    "LEN":"Big builder; FL/TX footprint, options-heavy.",
    "NVR":"Asset‑light builder; ruthless buybacks.",
    "TOL":"Luxury homes; margins, mood lighting.",
    "PHM":"Scale builder; move‑up exposure.",
    "KBH":"West/Sun Belt; first‑time skew.",
    "MTH":"Entry‑to‑move‑up; Sun Belt bias.",
    "GRBK":"Texas growth engine; niche swagger.",
    "BLDR":"Pro contractor supplier; price leverage.",
    "HD":"Home improvement mothership; Pro bellwether.",
    "LOW":"HD’s rival; catching Pro share.",
    "XHB":"Homebuilder/supplier ETF; diversified.",
    "ITB":"Builder‑heavy ETF; beta on housing.",
    "VNQ":"Broad REIT ETF; yield vehicle.",
    "SPG":"A‑mall REIT; dividends and Dior.",
    "PLD":"Logistics REIT; boxes for everything.",
    "AMT":"Tower REIT; 5G rent escalators.",
    "MAA":"Sun Belt multifamily; steady eddy.",
    "AVB":"Coastal Class‑A apartments; cyclical.",
    "EQR":"Urban coastal apts; regulation vibes.",
    "O":"Net‑lease REIT; monthly rent checks.",
    "INVH":"SFR landlord; scaled operations.",
    "AMH":"SFR REIT; build‑to‑rent push.",
    "Z":"Housing portal; ad machine (PA).",
    "RDFN":"Brokerage + portal; thin margins.",
    "OPEN":"iBuyer; inventory roulette wheel.",
    "OPAD":"Smaller iBuyer; Southeast survivor.",
    "RKT":"Mortgage factory; refi lever.",
    "UWMC":"Wholesale mortgage king; brokers first.",
    "BAC":"Big bank; consumer + mortgage.",
    "WFC":"Consumer bank; servicing baggage.",
    "JPM":"Mega bank; fortress balance sheet.",
    "USB":"Regional bank; payments chops."
  };
  const BUILDER_TICKERS=new Set(["DHI","LEN","NVR","TOL","PHM","KBH","MTH","GRBK","BLDR","XHB","ITB"]);
  function renderStocks(){
    const data=[
      ["DHI","D.R. Horton"],["LEN","Lennar"],["NVR","NVR"],["TOL","Toll Brothers"],["PHM","PulteGroup"],["KBH","KB Home"],
      ["MTH","Meritage"],["GRBK","Green Brick"],["BLDR","Builders FirstSource"],["HD","Home Depot"],["LOW","Lowe's"],
      ["XHB","SPDR Homebuilders"],["ITB","iShares Home Construction"],
      ["VNQ","Vanguard REIT"],["SPG","Simon Property"],["PLD","Prologis"],["AMT","American Tower"],["MAA","Mid‑America Apt"],
      ["AVB","AvalonBay"],["EQR","Equity Residential"],["O","Realty Income"],["INVH","Invitation Homes"],["AMH","American Homes 4 Rent"],
      ["Z","Zillow"],["RDFN","Redfin"],["OPEN","Opendoor"],["OPAD","Offerpad"],
      ["RKT","Rocket"],["UWMC","UWM"],["BAC","Bank of America"],["WFC","Wells Fargo"],["JPM","JPMorgan"],["USB","U.S. Bancorp"]
    ];
    STOCKS_DATA=[];
    const wrap=$("#stocksWrap"); wrap.innerHTML='';
    data.forEach(([t,n],i)=>{
      const price=(48+(i%12)*4+Math.random()*2).toFixed(2);
      const ch=(Math.random()*2-1).toFixed(2);
      STOCKS_DATA.push({t,n,price:parseFloat(price),ch:parseFloat(ch)});
      const cls= ch>0?'style="color:#16a34a"':(ch<0?'style="color:#dc2626"':'style="color:#64748b"');
      const desc = DESCRIPTIONS[t] || "Company in housing stack.";
      wrap.insertAdjacentHTML('beforeend',
        `<div class="stock-row">
           <div class="ticker">${t}</div>
           <div class="name">${n}</div>
           <div class="desc">${desc}</div>
           <div class="price">$${price}</div>
           <div ${cls}>${ch>0?'+':''}${ch}%</div>
         </div>`);
    });
  }

  // FEED (same demo content)
  function blockHTML(cat,what,numbers,just,why,market){
    return `<div class="block"><h4>${cat}</h4>
      <div class="lines">
        <div><span class="label">What:</span><span class="text">${what}</span></div>
        <div><span class="label">Numbers:</span><span class="text">${numbers}</span></div>
        <div><span class="label">Justified by:</span><span class="text">${just}</span></div>
        <div><span class="label">Why it matters:</span><span class="text">${why}</span></div>
        <div><span class="label">Market take:</span><span class="text">${market}</span></div>
      </div></div>`;
  }
  function renderFEED(){
    const today=[
      ["30‑year mortgage rate (Freddie Mac PMMS)","Weekly PMMS shows 30‑yr fixed up to 6.30% from 6.26%.","Range 6.26→6.30% w/w; spread to UST10 ~220–240bp.","Freddie Mac PMMS; Bloomberg composites.","Higher mortgage costs add friction to affordability; suppresses volume.","Builders/lenders mixed; curve steady."],
      ["Inflation / CPI","August CPI +0.4% m/m; 12‑month +2.9%.","+0.4% m/m; +2.9% y/y.","Bureau of Labor Statistics (CPI).","Sticky inflation keeps the Fed cautious.","Equities fade on hot prints; front‑end reprices."],
      ["PCE Inflation (nowcast)","Cleveland Fed nowcasts PCE ~3.08% annualized for Q3; core ~3.18%.","~3.08% (headline), ~3.18% (core).","Federal Reserve Bank of Cleveland (nowcast).","Far from 2% target → headwind for policy easing.","Rates biased higher if realized."]
    ];
    const mom=[
      ["30‑year mortgage rate","Over the month, 30‑yr ranged 6.26→6.30% (modest upward drift).","Δ ≈ +4bp m/m.","Freddie Mac PMMS.","Affordability strain persists; limited demand relief.","Homebuilder volumes constrained."],
      ["CPI / Inflation","CPI +0.4% m/m in Aug vs ~0.2% prior; annual 2.7→2.9%.","+0.4% m/m; +2.9% y/y.","BLS; cpiinflationcalculator.com recap.","Reacceleration is a red flag; Sept CPI/PCE in focus.","Rates sensitive to upside surprises."],
      ["PCE / Core PCE","PCE ~+2.6% y/y (July).","Core steady near ~2.6–2.9%.","BEA (PCE).","Stability doesn’t equal relief; services inflation sticky.","Curve remains choppy."],
      ["FHFA / House Prices","Q1 2025 +0.7% q/q; +4.0% y/y.","Quarterly +0.7%; YoY +4.0%.","FHFA HPI.","Appreciation decelerating; watch sensitivity to rates.","Valuations at risk if yields rise."]
    ];
    const qtd=[
      ["30‑year mortgage rate","From ~6.60–6.90% mid‑year to ~6.30% now; modest easing.","+10–30bp change depending series.","Freddie Mac; MND; context.","Breathing room but not low; any reversal hurts.","REITs whipsawed by curve; builder ETFs consolidate."],
      ["CPI / Inflation (annual/quarterly)","YoY CPI ~+2.9% (Aug).","Services sticky; shelter slow to roll off.","BLS; cpiinflationcalculator.com.","Inflation floor ~2.5–3%; cuts delayed absent disinflation.","Duration assets volatile."],
      ["PCE / Core PCE","PCE holding ~+2.6% y/y in recent months.","Core components (services, rent) stubborn.","BEA.","Fed patience likely; path narrow for cuts.","Rates remain elevated."],
      ["Real Residential Prices (BIS, real terms)","Real valuations have compressed vs peaks; moderation ongoing.","Deflated by CPI; gap vs nominal widens.","FRED / BIS series.","Real‑term pressure on housing.","Nominal stability ≠ fundamental strength."],
      ["Other Metrics (MBA, REIT, CMBS, Lumber)","Trepp CMBS delinquency ~7.08% (May 2025); CBRE mid‑year: MF rents recovering slowly in oversupplied markets.","CMBS delinq elevated; MF timelines extended.","Trepp; CBRE.","CRE stress persists; multifamily least bad but uneven.","Credit‑sensitive names react to curve."]
    ];
    const t=$("#today"), m=$("#mom"), q=$("#qtd");
    t.innerHTML=m.innerHTML=q.innerHTML='';
    today.forEach(b=> t.insertAdjacentHTML('beforeend', blockHTML(...b)));
    mom.forEach(b=> m.insertAdjacentHTML('beforeend', blockHTML(...b)));
    qtd.forEach(b=> q.insertAdjacentHTML('beforeend', blockHTML(...b)));
    const d=new Date();
    set('feedTime', d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}));
    set('feedDate', d.toLocaleDateString());
    set('lastUpdated', d.toLocaleString());
  }

  // Takeaways
  function generateTakeaways(){
    const mort = $('#mort30')?.innerText || '';
    const mortDelta = $('#mort30Delta')?.innerText || '';
    const ust10 = $('#ust10')?.innerText || '';

    // Permits breadth for current type
    let upPerm=0, downPerm=0, upDOM=0, downDOM=0, leader=null, bestMoM=-1e9;
    Object.entries(METROS).forEach(([key, meta])=>{
      const total = genSeries(meta.base, 160, 24, meta.seed);
      const {total:tot, s1, s24, s5} = splitTypes(total, meta.seed+7);
      const series = (CURRENT_TYPE==="1unit")? s1 : (CURRENT_TYPE==="2to4")? s24 : (CURRENT_TYPE==="5plus")? s5 : tot;
      const months = []; for(let y=0;y<2;y++){ for(let m=1;m<=12;m++){ months.push(`${y?2025:2024}-${String(m).padStart(2,'0')}`);} }
      const latestYM = "2025-08"; const latestIdx = months.indexOf(latestYM);

      const mom = pct(series[latestIdx], series[latestIdx-1]);
      if(mom>0) upPerm++; else if(mom<0) downPerm++;
      if(mom>bestMoM){ bestMoM=mom; leader=meta.name.split('–')[0]; }
      const domSeries = genSeries(meta.domBase, 6, 24, meta.seed+100).map(v=>Math.max(20, Math.round(v/3.4)));
      const domMoM = pct(domSeries[latestIdx], domSeries[latestIdx-1]);
      if(domMoM>0) upDOM++; else if(domMoM<0) downDOM++;
    });

    // Stocks breadth among builders
    let upB=0, downB=0; let best=null, worst=null;
    STOCKS_DATA.forEach(o=>{
      if(["DHI","LEN","NVR","TOL","PHM","KBH","MTH","GRBK","BLDR","XHB","ITB"].includes(o.t)){
        if(o.ch>0) upB++; else if(o.ch<0) downB++;
      }
      if(!best || o.ch>best.ch) best=o;
      if(!worst || o.ch<worst.ch) worst=o;
    });

    // FEED pull
    const cpiNode = Array.from(document.querySelectorAll('#today .block h4')).find(h=>h.textContent.includes('Inflation / CPI'));
    const cpiNumbers = cpiNode ? cpiNode.parentElement.querySelectorAll('.text')[1].textContent : '—';
    const pceNode = Array.from(document.querySelectorAll('#today .block h4')).find(h=>h.textContent.includes('PCE Inflation'));
    const pceNumbers = pceNode ? pceNode.parentElement.querySelectorAll('.text')[1].textContent : '—';

    const typeLabel = (CURRENT_TYPE==="total")?"Total":(CURRENT_TYPE==="1unit")?"1‑Unit":(CURRENT_TYPE==="2to4")?"2–4":"5+";
    const bullets = [
      `Mortgage ${mort} (${mortDelta}). Affordability still doing burpees.`,
      `CPI/PCE not tapping out: ${cpiNumbers} | ${pceNumbers}.`,
      `${typeLabel} permits breadth: ${upPerm} up / ${downPerm} down m/m; leader = ${leader}.`,
      `DOM direction: ${upDOM} metros longer / ${downDOM} shorter m/m — leverage shifting to buyers where DOM lengthens.`,
      `Homebuilder tape: breadth mixed. Best ${best?.t}, worst ${worst?.t}.`,
      `10Y ${ust10}. If it drifts up, cap rates won’t wait.`,
      `Move: price risk into bids, assume slower turns, keep optionality sacred. Hope ≠ cash flow.`
    ];
    $('#takeaways').innerHTML = "• " + bullets.join("<br/>• ");
  }

  // Export controls
  function feedTextFromDOM(){
    const now=new Date();
    const head=`## FEED: RE Ticker — ${now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})} — ${now.toLocaleDateString()}\n\nBelow is a concise “ticker” style update for real estate & housing macro / capital markets.\n`;
    const sections=[
      ["(1) Changes Today", "#today"],
      ["(2) Month‑over‑Month (MoM)", "#mom"],
      ["(3) Quarter‑to‑Date (or longer)", "#qtd"],
      ["Summary Takeaways (No Sugarcoat)", "#takeaways"]
    ];
    const blocksToText = (sel)=>{
      const nodes=document.querySelectorAll(sel+" .block");
      let out="";
      nodes.forEach(n=>{
        const cat=n.querySelector('h4').textContent.trim();
        const texts=n.querySelectorAll('.text');
        const [what,nums,just,why,market]=Array.from(texts).map(x=>x.textContent.trim());
        out+=`\n${cat}\n  • What: ${what}\n  • Numbers: ${nums}\n  • Justified by: ${just}\n  • Why / Outlook: ${why}\n  • Market take: ${market}\n`;
      });
      return out;
    };
    let txt=head;
    sections.slice(0,3).forEach(([title,sel])=>{ txt+=`\n${title}\n${blocksToText(sel)}`; });
    txt+=`\n${sections[3][0]}\n`+document.querySelector('#takeaways').innerText.split('\\n').map(x=>"  • "+x).join('\\n')+"\\n";
    return txt;
  }
  document.getElementById('copyFeed').addEventListener('click', async ()=>{
    const text=feedTextFromDOM();
    try{ await navigator.clipboard.writeText(text); alert('FEED copied to clipboard.'); }
    catch(e){ alert('Copy failed; use Export TXT.'); }
  });
  document.getElementById('downloadTxt').addEventListener('click', ()=>{
    const blob = new Blob([feedTextFromDOM()], {type:'text/plain'});
    const url = URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='FEED_RE_Ticker_v6_FINAL_Toggle_DOM_DESCRIPTIONS.txt'; a.click(); URL.revokeObjectURL(url);
  });
  document.getElementById('downloadHtml').addEventListener('click', ()=>{
    const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
    const url = URL.createObjectURL(blob); const a=document.createElement('a');
    a.href=url; a.download='market_housing_dashboard_v6_FINAL_Toggle_DOM_DESCRIPTIONS_COLOR.html'; a.click(); URL.revokeObjectURL(url);
  });
  document.getElementById('refreshTakeaways').addEventListener('click', generateTakeaways);

  // Init
  (function init(){
    initMacro();
    renderFLPermitsKPI();
    renderStocks();
    renderFEED();
    generateTakeaways();
    const d=new Date();
    document.getElementById('lastUpdated').textContent = d.toLocaleString();
  })();
</script>

<script>
/* FINAL dashboard data hydration — uses data/state.json produced by GitHub Actions */
(async function () {
  // Fetch state.json (cache-buster to avoid stale CDN)
  let resp;
  try {
    resp = await fetch('data/state.json?cb=' + Date.now());
  } catch (e) {
    console.error('Failed to fetch state.json', e);
    document.getElementById('lastUpdated')?.replaceChildren('Failed to load data.');
    return;
  }
  if (!resp.ok) {
    document.getElementById('lastUpdated')?.replaceChildren('No data yet.');
    return;
  }
  const S = await resp.json();

  // Helpers
  const fmtPct = (x, d=2) => (x === null || x === undefined) ? '—' : ((x>=0?'+':'') + (100*x).toFixed(d) + '%');
  const cls = (x) => (x>0?'pos':(x<0?'neg':'flat'));
  const setHTML = (el, html) => { if (el) el.innerHTML = html; };
  const setText = (el, txt) => { if (el) el.textContent = txt; };

  // 1) Header "As of"
  setText(document.getElementById('lastUpdated'), S.as_of || '—');

  // 2) Macro cards (S&P 500, 10Y, 30Y Mortgage, Housing Starts)
  if (S.macro?.spx) {
    const p = Number(S.macro.spx.price || 0);
    const d = Number(S.macro.spx.pct_1d || 0);
    setText(document.getElementById('spx'), p.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}));
    setHTML(document.getElementById('spxDelta'),
      `<span class="${cls(d)}">${fmtPct(d,2)}</span> 1d`);
  }
  if (S.macro?.ten_year) {
    // ten_year.yield_pct is a percent like 4.27 (not 0.0427)
    const y = Number(S.macro.ten_year.yield_pct || 0);
    const bp = Math.round(Number(S.macro.ten_year.delta_bp_1d || 0));
    setText(document.getElementById('ust10'), y.toFixed(2) + '%');
    setHTML(document.getElementById('ust10Delta'),
      `<span class="${cls(bp)}">${bp>=0?'+':''}${bp}bp</span>`);
  }
  if (S.macro?.mortgage_30y) {
    const y = Number(S.macro.mortgage_30y.rate_pct || 0);
    const bp = Math.round(Number(S.macro.mortgage_30y.delta_bp_wow || 0));
    setText(document.getElementById('mort30'), y.toFixed(2) + '%');
    setHTML(document.getElementById('mort30Delta'),
      `<span class="${cls(bp)}">${bp>=0?'+':''}${bp}bp</span> w/w`);
  }
  if (S.macro?.starts) {
    const lvl = Number(S.macro.starts.level_saar || 0); // SAAR units
    const mom = Number(S.macro.starts.mom || 0);
    setText(document.getElementById('starts'), (lvl/1_000_000).toFixed(2) + 'm SAAR');
    setHTML(document.getElementById('startsDelta'),
      `<span class="${cls(mom)}">${fmtPct(mom,1)}</span> m/m`);
  }

  // 3) Florida Permits — by Metro (Total vs 1-Unit)
  const msas = S.permits?.msa || {};
  const dom = (m) => m?.dom ? m.dom : null;
  // Map your visible labels to FRED/JSON keys
  const KEY = {
    'Orlando–Kissimmee–Sanford': 'Orlando–Kissimmee–Sanford',
    'Ocala Metro Area': 'Ocala',
    'Tampa–Saint Petersburg–Clearwater': 'Tampa–St. Petersburg–Clearwater',
    'Melbourne–Palm Bay–Titusville': 'Palm Bay–Melbourne–Titusville'
  };

  function render(type) {
    document.querySelectorAll('#flPermitsKPI .kpi').forEach(kpi => {
      const label = kpi.querySelector('.label')?.textContent.trim() || '';
      const key = KEY[label] || label;
      const M = msas[key];
      const blocks = kpi.querySelectorAll('.kpi-sub'); // [0]=Latest, [1]=YTD, [2]=DOM
      if (!M || blocks.length < 3) return;

      const bucket = (type === '1unit') ? M.one_unit : M.total; // Only these two are wired now
      // 0) Latest month
      const b0 = blocks[0];
      if (bucket) {
        setText(b0.querySelector('.sub-label'), `Latest Month · Units authorized (NSA) — ${type==='1unit'?'1-Unit':'Total'}`);
        setText(b0.querySelector('.value'), (bucket.latest ?? '—').toLocaleString());
        const mom = bucket.mom, yoy = bucket.yoy;
        setHTML(b0.querySelector('.delta'),
          `<span class="${cls(mom)}">${fmtPct(mom,1)} MoM</span> · <span class="${cls(yoy)}">${fmtPct(yoy,1)} YoY</span>`);
      } else {
        setText(b0.querySelector('.sub-label'), `Latest Month — ${type==='1unit'?'1-Unit':'Total'}`);
        setText(b0.querySelector('.value'), '—');
        setHTML(b0.querySelector('.delta'), `<span class="flat">—</span>`);
      }
      // 1) YTD
      const b1 = blocks[1];
      if (bucket) {
        const mname = bucket.latest_month_name || bucket.latest_month || '—';
        const yr = bucket.latest_year || '—';
        setText(b1.querySelector('.sub-label'), `YTD · Jan–${mname} ${yr} vs ${yr-1} — ${type==='1unit'?'1-Unit':'Total'}`);
        setText(b1.querySelector('.value'), (bucket.ytd_count ?? '—').toLocaleString());
        setHTML(b1.querySelector('.delta'), `<span class="${cls(bucket.ytd_yoy)}">${fmtPct(bucket.ytd_yoy,1)} Y/Y</span>`);
      } else {
        setText(b1.querySelector('.sub-label'), `YTD — ${type==='1unit'?'1-Unit':'Total'}`);
        setText(b1.querySelector('.value'), '—');
        setHTML(b1.querySelector('.delta'), `<span class="flat">—</span>`);
      }
      // 2) DOM (median days on market)
      const b2 = blocks[2];
      const D = dom(M);
      if (D) {
        setText(b2.querySelector('.value'), `${D.days} days`);
        setHTML(b2.querySelector('.delta'),
          `<span class="${cls(D.yoy)}">${fmtPct(D.yoy,1)} YoY</span> <span class="fine">(${D.as_of || '—'})</span>`);
      } else {
        setText(b2.querySelector('.value'), '—');
        setHTML(b2.querySelector('.delta'), `<span class="flat">—</span>`);
      }
    });
  }

  // Hook up the Type toggle
  const toggles = document.querySelectorAll('#typeToggle button');
  toggles.forEach(btn => {
    btn.addEventListener('click', () => {
      toggles.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      render(btn.dataset.type);
    });
  });
  // Initial render
  render(document.querySelector('#typeToggle button.active')?.dataset.type || 'total');
})();
</script>

</body></html>
